<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kkl.kklplus.provider.rpt.mapper.CustomerRechargeSummaryMapper">
    <select id="getOnlineRechargeSummaryList" resultType="com.kkl.kklplus.entity.rpt.RPTCustomerRechargeSummaryEntity">
        SELECT fc.customer_id AS customerId,
        SUM(fc.amount) AS onlineRechargeAmount
        FROM fi_customercurrency fc
        WHERE
        fc.action_type = 10
        <if test="customerId!= null">
           AND fc.customer_id = #{customerId}
        </if>
        And fc.update_date >= #{beginDate}
        AND <![CDATA[ fc.update_date <= #{endDate} ]]>
        <if test="quarter != null">
         AND fc.quarter = #{quarter}
        </if>
        group by customerId
    </select>


    <select id="getFinancialRechargeSummaryList" resultType="com.kkl.kklplus.entity.rpt.RPTCustomerRechargeSummaryEntity">
        SELECT fc.customer_id AS customerId,
        SUM(fc.amount) AS financialRechargeAmount
        FROM fi_customercurrency fc
        WHERE
        fc.action_type = 20
        <if test="customerId!= null">
            AND fc.customer_id = #{customerId}
        </if>
        And fc.update_date >= #{beginDate}
        AND <![CDATA[ fc.update_date <= #{endDate} ]]>
        <if test="quarter != null">
            AND fc.quarter = #{quarter}
        </if>
        group by customerId
    </select>


    <select id="getRechargeSummaryList" resultType="com.kkl.kklplus.entity.rpt.RPTCustomerRechargeSummaryEntity">
        SELECT fc.customer_id AS customerId,
        SUM(fc.amount) AS offlineRechargeAmount
        FROM fi_customercurrency fc
        WHERE
        fc.action_type = 90
        <if test="customerId!= null">
            AND fc.customer_id = #{customerId}
        </if>
        And fc.update_date >= #{beginDate}
        AND <![CDATA[ fc.update_date <= #{endDate} ]]>
        <if test="quarter != null">
            AND fc.quarter = #{quarter}
        </if>
        group by customerId
    </select>

    <select id="hasReportData" resultType="java.lang.Integer">
        select
        count(0)
        FROM fi_customercurrency fc
        WHERE
        fc.update_date >= #{beginDate}
        AND <![CDATA[ fc.update_date <= #{endDate} ]]>
        AND fc.action_type IN (10,20,90)
        <if test="customerId!= null">
            AND fc.customer_id = #{customerId}
        </if>
        <if test="quarter != null">
            AND fc.quarter = #{quarter}
        </if>
    </select>
</mapper>